---
title: "EDA"
output: html_document
---

```{r}
library(dplyr)
library(stringr)
library(rebus)
library(ggplot2)
###combine all the datasets
setwd("./data")
indeed=read.csv("indeed_results1.csv")[,-1]

stack=read.csv("data_science.csv")[,-1]
merck=read.csv("merck_results.csv")[,-1]
roche=read.csv("roche_results.csv")[,-1]
sanofi=read.csv("sanofi_results.csv")[,-1]

ind=1:dim(merck)[1]
set.seed(123)
merck=merck[sample(ind,15),]

full_dat=data.frame(title=c(as.character(indeed$title),as.character(stack$title),as.character(merck$title),as.character(sanofi$title),as.character(roche$title)),company=c(as.character(indeed$company),as.character(stack$company),rep("merck",15),rep("sanofi",15),rep("roche",15)),location=c(as.character(indeed$location),as.character(stack$location),as.character(merck$location),as.character(sanofi$location),rep(NA,15)),desc=c(as.character(indeed$desc),as.character(stack$desc),as.character(merck$desc),as.character(sanofi$desc),as.character(roche$desc)))
full_dat=full_dat[!duplicated(full_dat),]

desc1=sapply(as.character(full_dat$desc),function(x) tolower(str_trim(str_replace_all(x, "[^[:alnum:]]", " ")
)))

skills=data.frame(hadoop=as.numeric(str_detect(desc1,pattern = "hadoop")),
           python=as.numeric(str_detect(desc1,pattern = "python")),
           sql=as.numeric(str_detect(desc1,pattern =,optional(exactly("my"))%R%'sql' )),
           r=as.numeric(str_detect(desc1,pattern = SPC%R%'r'%R%SPC)),
          spark=as.numeric(str_detect(desc1,pattern = "spark")),
          sas=as.numeric(str_detect(desc1,pattern =SPC%R%'sas'%R%SPC )),
          aws=as.numeric(str_detect(desc1,pattern =or("amazon"%R%optional(one_or_more(SPC))%R%"web"%R%optional(one_or_more(SPC))%R%"service","aws"))),
          excel=as.numeric(str_detect(desc1,pattern = "excel")),
          azure=as.numeric(str_detect(desc1,pattern = "azure")),
          java=as.numeric(str_detect(desc1,pattern ='java'%R%optional(exactly("script") ))),
          tableau=as.numeric(str_detect(desc1,pattern ='tableau')),
          deep_learning=as.numeric(str_detect(desc1,pattern ="deep"%R%optional(one_or_more(SPC))%R%"learning")),
machine_learning=as.numeric(str_detect(desc1,pattern ="machine"%R%optional(one_or_more(SPC))%R%"learning")),
ai=as.numeric(str_detect(desc1,pattern =or("artificial"%R%optional(one_or_more(SPC))%R%"intelligence",SPC%R%"ai"%R%SPC))),
      stat=  as.numeric(str_detect(desc1,pattern ="statistics")),
      pandas=as.numeric(str_detect(desc1,pattern ="pandas")),
      scipy=as.numeric(str_detect(desc1,pattern ="scipy")),
      cplus=as.numeric(str_detect(desc1,pattern =SPC%R%'c'%R%"+"%R%"+"%R%SPC)),
      perl=as.numeric(str_detect(desc1,pattern ="perl")),
      text_mining=as.numeric(str_detect(desc1,pattern ="text"%R%optional(one_or_more(SPC))%R%"mining")),
      matlab=as.numeric(str_detect(desc1,pattern ="matlab")),
      xml=as.numeric(str_detect(desc1,pattern =SPC%R%"c"%R%SPC)),
        hive=as.numeric(str_detect(desc1,pattern ="hive")),
      splunk=as.numeric(str_detect(desc1,pattern ="splunk")),
            database=as.numeric(str_detect(desc1,pattern ="database")),
            modeling=as.numeric(str_detect(desc1,pattern ="modeling")),
      
data_mining=as.numeric(str_detect(desc1,pattern ="data"%R%optional(one_or_more(SPC))%R%"mining")),
time_series=as.numeric(str_detect(desc1,pattern ="time"%R%optional(one_or_more(SPC))%R%"series")),
jupyter=as.numeric(str_detect(desc1,pattern ="jupyter")),
shell=as.numeric(str_detect(desc1,pattern ="shell")),
unix=as.numeric(str_detect(desc1,pattern ="unix")),
linux=as.numeric(str_detect(desc1,pattern ="linux")),
api=as.numeric(str_detect(desc1,pattern =SPC%R%"api"%R%SPC)),
cloud=as.numeric(str_detect(desc1,pattern ="cloud")),
apache=as.numeric(str_detect(desc1,pattern ="apache")),
swift=as.numeric(str_detect(desc1,pattern ="swift"))
)
full_dat=cbind(full_dat,skills)

ct=as.numeric(apply(skills, 2, function(x) sum(x,na.rm = T)))
skills1=data.frame(skill=colnames(skills),ct=ct)

p <- ggplot(skills1, aes(reorder(skill,-ct), ct)) + geom_bar(stat="identity") + 
  labs(x = 'Skill', y = 'Count', title ='Skill Counts ')
p+theme(axis.text.x=element_text(angle=90, hjust=1))+xlab("")

edu=data.frame(master=as.numeric(str_detect(desc1,pattern = or("master","masters",SPC%R%'ms'%R%SPC))),
           phd=as.numeric(str_detect(desc1,pattern = or(SPC%R%'phd'%R%SPC,"doctor","doctoral"))),
           undergrad=as.numeric(str_detect(desc1,pattern =or("bachelor","bachelors","undergrad","undergraduate"))))
edu$highest_edu=ifelse(edu$phd==1,"phd",ifelse(edu$master==1,"ms","bachelor"))

full_dat$highest_edu=edu$highest_edu
table(full_dat$highest_edu)

write.csv(skills,"full_dat.csv")

```